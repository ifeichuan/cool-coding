---
title: å¾®æœåŠ¡æµ‹è¯•ç­–ç•¥
description: äº†è§£å¾®æœåŠ¡æ¶æ„ä¸­çš„æµ‹è¯•ç­–ç•¥ï¼ŒåŒ…æ‹¬å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€ç«¯åˆ°ç«¯æµ‹è¯•ç­‰ï¼Œå¹¶é€šè¿‡å®é™…æ¡ˆä¾‹å±•ç¤ºå¦‚ä½•æœ‰æ•ˆæµ‹è¯• Spring Cloud Alibaba å¾®æœåŠ¡ã€‚
---

# å¾®æœåŠ¡æµ‹è¯•ç­–ç•¥

åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œæµ‹è¯•æ˜¯ç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§å’ŒåŠŸèƒ½æ­£ç¡®æ€§çš„å…³é”®ç¯èŠ‚ã€‚ç”±äºå¾®æœåŠ¡æ¶æ„çš„åˆ†å¸ƒå¼ç‰¹æ€§ï¼Œä¼ ç»Ÿçš„å•ä½“åº”ç”¨æµ‹è¯•æ–¹æ³•ä¸å†é€‚ç”¨ã€‚æœ¬æ–‡å°†ä»‹ç»å¾®æœåŠ¡æµ‹è¯•çš„æ ¸å¿ƒç­–ç•¥ï¼Œå¹¶é€šè¿‡å®é™…æ¡ˆä¾‹å±•ç¤ºå¦‚ä½•åœ¨ Spring Cloud Alibaba ä¸­å®ç°è¿™äº›æµ‹è¯•ç­–ç•¥ã€‚

## ä»€ä¹ˆæ˜¯å¾®æœåŠ¡æµ‹è¯•ç­–ç•¥ï¼Ÿ

å¾®æœåŠ¡æµ‹è¯•ç­–ç•¥æ˜¯æŒ‡åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œé’ˆå¯¹ä¸åŒå±‚æ¬¡å’ŒèŒƒå›´çš„æµ‹è¯•æ–¹æ³•ã€‚ç”±äºå¾®æœåŠ¡ä¹‹é—´ç›¸äº’ç‹¬ç«‹ä½†åˆç´§å¯†åä½œï¼Œæµ‹è¯•éœ€è¦è¦†ç›–ä»å•ä¸ªæœåŠ¡åˆ°æ•´ä¸ªç³»ç»Ÿçš„å„ä¸ªå±‚é¢ã€‚å¸¸è§çš„å¾®æœåŠ¡æµ‹è¯•ç­–ç•¥åŒ…æ‹¬ï¼š

1. **å•å…ƒæµ‹è¯•**ï¼šæµ‹è¯•å•ä¸ªæœåŠ¡çš„æœ€å°åŠŸèƒ½å•å…ƒã€‚
2. **é›†æˆæµ‹è¯•**ï¼šæµ‹è¯•æœåŠ¡ä¹‹é—´çš„äº¤äº’ã€‚
3. **ç«¯åˆ°ç«¯æµ‹è¯•**ï¼šéªŒè¯æ•´ä¸ªç³»ç»Ÿçš„åŠŸèƒ½æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚
4. **å¥‘çº¦æµ‹è¯•**ï¼šç¡®ä¿æœåŠ¡ä¹‹é—´çš„æ¥å£ä¸€è‡´æ€§ã€‚
5. **æ€§èƒ½æµ‹è¯•**ï¼šè¯„ä¼°ç³»ç»Ÿåœ¨é«˜è´Ÿè½½ä¸‹çš„è¡¨ç°ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†é€æ­¥è®²è§£è¿™äº›æµ‹è¯•ç­–ç•¥ï¼Œå¹¶é€šè¿‡ä»£ç ç¤ºä¾‹å±•ç¤ºå¦‚ä½•åœ¨ Spring Cloud Alibaba ä¸­å®ç°å®ƒä»¬ã€‚

---

## 1. å•å…ƒæµ‹è¯•

å•å…ƒæµ‹è¯•æ˜¯å¾®æœåŠ¡æµ‹è¯•çš„åŸºç¡€ï¼Œå®ƒä¸“æ³¨äºæµ‹è¯•å•ä¸ªæœåŠ¡çš„æœ€å°åŠŸèƒ½å•å…ƒã€‚åœ¨ Spring Cloud Alibaba ä¸­ï¼Œé€šå¸¸ä½¿ç”¨ JUnit å’Œ Mockito è¿›è¡Œå•å…ƒæµ‹è¯•ã€‚

### ç¤ºä¾‹ï¼šæµ‹è¯•ä¸€ä¸ªç®€å•çš„æœåŠ¡æ–¹æ³•

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª `UserService`ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªæ–¹æ³• `getUserById`ï¼š

```java
@Service
public class UserService {
    @Autowired
    private UserRepository userRepository;

    public User getUserById(Long id) {
        return userRepository.findById(id).orElseThrow(() -> new RuntimeException("User not found"));
    }
}
```

æˆ‘ä»¬å¯ä»¥ç¼–å†™ä»¥ä¸‹å•å…ƒæµ‹è¯•ï¼š

```java
@ExtendWith(MockitoExtension.class)
public class UserServiceTest {

    @Mock
    private UserRepository userRepository;

    @InjectMocks
    private UserService userService;

    @Test
    void testGetUserById() {
        User mockUser = new User(1L, "John Doe");
        when(userRepository.findById(1L)).thenReturn(Optional.of(mockUser));

        User result = userService.getUserById(1L);
        assertEquals("John Doe", result.getName());
    }
}
```

:::tip
åœ¨å•å…ƒæµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ `@Mock` æ³¨è§£æ¨¡æ‹Ÿä¾èµ–é¡¹ï¼ˆå¦‚ `UserRepository`ï¼‰ï¼Œå¹¶ä½¿ç”¨ `@InjectMocks` å°†æ¨¡æ‹Ÿå¯¹è±¡æ³¨å…¥åˆ°è¢«æµ‹ç±»ä¸­ã€‚
:::

---

## 2. é›†æˆæµ‹è¯•

é›†æˆæµ‹è¯•ç”¨äºéªŒè¯æœåŠ¡ä¹‹é—´çš„äº¤äº’æ˜¯å¦æ­£ç¡®ã€‚åœ¨ Spring Cloud Alibaba ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ `@SpringBootTest` æ³¨è§£å¯åŠ¨å®Œæ•´çš„ Spring ä¸Šä¸‹æ–‡è¿›è¡Œæµ‹è¯•ã€‚

### ç¤ºä¾‹ï¼šæµ‹è¯•æœåŠ¡ä¸æ•°æ®åº“çš„äº¤äº’

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª `UserController`ï¼Œå®ƒä¾èµ–äº `UserService`ï¼š

```java
@RestController
@RequestMapping("/users")
public class UserController {

    @Autowired
    private UserService userService;

    @GetMapping("/{id}")
    public User getUserById(@PathVariable Long id) {
        return userService.getUserById(id);
    }
}
```

æˆ‘ä»¬å¯ä»¥ç¼–å†™ä»¥ä¸‹é›†æˆæµ‹è¯•ï¼š

```java
@SpringBootTest
@AutoConfigureMockMvc
public class UserControllerIntegrationTest {

    @Autowired
    private MockMvc mockMvc;

    @MockBean
    private UserService userService;

    @Test
    void testGetUserById() throws Exception {
        User mockUser = new User(1L, "John Doe");
        when(userService.getUserById(1L)).thenReturn(mockUser);

        mockMvc.perform(get("/users/1"))
               .andExpect(status().isOk())
               .andExpect(jsonPath("$.name").value("John Doe"));
    }
}
```

:::note
åœ¨é›†æˆæµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ `@MockBean` æ¨¡æ‹ŸæœåŠ¡å±‚ï¼Œå¹¶é€šè¿‡ `MockMvc` æ¨¡æ‹Ÿ HTTP è¯·æ±‚ã€‚
:::

---

## 3. ç«¯åˆ°ç«¯æµ‹è¯•

ç«¯åˆ°ç«¯æµ‹è¯•ç”¨äºéªŒè¯æ•´ä¸ªç³»ç»Ÿçš„åŠŸèƒ½æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚åœ¨ Spring Cloud Alibaba ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å·¥å…·å¦‚ Testcontainers æ¥å¯åŠ¨ä¾èµ–çš„å¤–éƒ¨æœåŠ¡ï¼ˆå¦‚æ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰ï¼‰ã€‚

### ç¤ºä¾‹ï¼šæµ‹è¯•ç”¨æˆ·æ³¨å†Œæµç¨‹

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç”¨æˆ·æ³¨å†Œæµç¨‹ï¼Œæ¶‰åŠå¤šä¸ªæœåŠ¡ï¼š

```mermaid
graph LR
    A[ç”¨æˆ·æ³¨å†Œè¯·æ±‚] --> B[ç”¨æˆ·æœåŠ¡]
    B --> C[é‚®ä»¶æœåŠ¡]
    B --> D[æ•°æ®åº“]
```

æˆ‘ä»¬å¯ä»¥ç¼–å†™ä»¥ä¸‹ç«¯åˆ°ç«¯æµ‹è¯•ï¼š

```java
@SpringBootTest
@Testcontainers
public class UserRegistrationEndToEndTest {

    @Container
    private static final PostgreSQLContainer<?> postgres = new PostgreSQLContainer<>("postgres:13");

    @DynamicPropertySource
    static void configureProperties(DynamicPropertyRegistry registry) {
        registry.add("spring.datasource.url", postgres::getJdbcUrl);
        registry.add("spring.datasource.username", postgres::getUsername);
        registry.add("spring.datasource.password", postgres::getPassword);
    }

    @Autowired
    private MockMvc mockMvc;

    @Test
    void testUserRegistration() throws Exception {
        mockMvc.perform(post("/users/register")
               .contentType(MediaType.APPLICATION_JSON)
               .content("{\"name\": \"John Doe\", \"email\": \"john@example.com\"}"))
               .andExpect(status().isCreated());
    }
}
```

:::caution
ç«¯åˆ°ç«¯æµ‹è¯•é€šå¸¸è€—æ—¶è¾ƒé•¿ï¼Œå»ºè®®ä»…åœ¨å…³é”®æµç¨‹ä¸­ä½¿ç”¨ã€‚
:::

---

## 4. å¥‘çº¦æµ‹è¯•

å¥‘çº¦æµ‹è¯•ç”¨äºç¡®ä¿æœåŠ¡ä¹‹é—´çš„æ¥å£ä¸€è‡´æ€§ã€‚åœ¨ Spring Cloud Alibaba ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Pact æˆ– Spring Cloud Contract è¿›è¡Œå¥‘çº¦æµ‹è¯•ã€‚

### ç¤ºä¾‹ï¼šä½¿ç”¨ Spring Cloud Contract

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª `OrderService`ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªåˆ›å»ºè®¢å•çš„æ¥å£ï¼š

```java
@RestController
@RequestMapping("/orders")
public class OrderController {

    @PostMapping
    public Order createOrder(@RequestBody OrderRequest request) {
        // åˆ›å»ºè®¢å•é€»è¾‘
    }
}
```

æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªå¥‘çº¦æ–‡ä»¶ `createOrder.groovy`ï¼š

```groovy
Contract.make {
    request {
        method 'POST'
        url '/orders'
        body([
            productId: 1,
            quantity: 2
        ])
    }
    response {
        status 201
        body([
            orderId: 1,
            status: "CREATED"
        ])
    }
}
```

ç„¶åé€šè¿‡ Spring Cloud Contract ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹å¹¶éªŒè¯æ¥å£æ˜¯å¦ç¬¦åˆå¥‘çº¦ã€‚

---

## 5. æ€§èƒ½æµ‹è¯•

æ€§èƒ½æµ‹è¯•ç”¨äºè¯„ä¼°ç³»ç»Ÿåœ¨é«˜è´Ÿè½½ä¸‹çš„è¡¨ç°ã€‚åœ¨ Spring Cloud Alibaba ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ JMeter æˆ– Gatling è¿›è¡Œæ€§èƒ½æµ‹è¯•ã€‚

### ç¤ºä¾‹ï¼šä½¿ç”¨ Gatling æµ‹è¯•ç”¨æˆ·ç™»å½•æ¥å£

```scala
class UserLoginSimulation extends Simulation {

  val httpProtocol = http
    .baseUrl("http://localhost:8080")
    .acceptHeader("application/json")

  val scn = scenario("User Login")
    .exec(http("Login Request")
      .post("/users/login")
      .body(StringBody("""{"username": "john", "password": "password"}"""))
      .check(status.is(200)))

  setUp(
    scn.inject(atOnceUsers(100))
  ).protocols(httpProtocol)
}
```

---

## æ€»ç»“

å¾®æœåŠ¡æµ‹è¯•ç­–ç•¥æ˜¯ç¡®ä¿åˆ†å¸ƒå¼ç³»ç»Ÿç¨³å®šæ€§å’ŒåŠŸèƒ½æ­£ç¡®æ€§çš„å…³é”®ã€‚é€šè¿‡å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€ç«¯åˆ°ç«¯æµ‹è¯•ã€å¥‘çº¦æµ‹è¯•å’Œæ€§èƒ½æµ‹è¯•ï¼Œæˆ‘ä»¬å¯ä»¥å…¨é¢è¦†ç›–å¾®æœåŠ¡æ¶æ„ä¸­çš„å„ä¸ªæµ‹è¯•å±‚é¢ã€‚åœ¨ Spring Cloud Alibaba ä¸­ï¼Œç»“åˆé€‚å½“çš„å·¥å…·å’Œæ¡†æ¶ï¼Œå¯ä»¥é«˜æ•ˆåœ°å®ç°è¿™äº›æµ‹è¯•ç­–ç•¥ã€‚

---

## é™„åŠ èµ„æº

- [Spring Boot Testing Guide](https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.testing)
- [Testcontainers Documentation](https://www.testcontainers.org/)
- [Spring Cloud Contract Documentation](https://spring.io/projects/spring-cloud-contract)

---

## ç»ƒä¹ 

1. ä¸ºä½ çš„å¾®æœåŠ¡é¡¹ç›®ç¼–å†™å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•ã€‚
2. ä½¿ç”¨ Testcontainers å®ç°ä¸€ä¸ªç«¯åˆ°ç«¯æµ‹è¯•ã€‚
3. å°è¯•ä½¿ç”¨ Spring Cloud Contract å®šä¹‰å¹¶éªŒè¯ä¸€ä¸ªæœåŠ¡å¥‘çº¦ã€‚

Happy Testing! ğŸš€
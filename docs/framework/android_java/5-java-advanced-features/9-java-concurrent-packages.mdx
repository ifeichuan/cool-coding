---
title: Javaå¹¶å‘åŒ…
description: äº†è§£Javaå¹¶å‘åŒ…ï¼ˆjava.util.concurrentï¼‰çš„æ ¸å¿ƒæ¦‚å¿µã€å·¥å…·ç±»åŠå…¶åœ¨å®é™…å¼€å‘ä¸­çš„åº”ç”¨ï¼Œå¸®åŠ©åˆå­¦è€…æŒæ¡å¤šçº¿ç¨‹ç¼–ç¨‹çš„é«˜çº§ç‰¹æ€§ã€‚
---

## ä»‹ç»

Javaå¹¶å‘åŒ…ï¼ˆ`java.util.concurrent`ï¼‰æ˜¯Javaæ ‡å‡†åº“ä¸­ç”¨äºç®€åŒ–å¤šçº¿ç¨‹ç¼–ç¨‹çš„å·¥å…·åŒ…ã€‚å®ƒæä¾›äº†ä¸€ç³»åˆ—å¼ºå¤§çš„å·¥å…·ç±»å’Œæ¥å£ï¼Œå¸®åŠ©å¼€å‘è€…æ›´é«˜æ•ˆåœ°å¤„ç†å¹¶å‘ä»»åŠ¡ï¼Œé¿å…å¸¸è§çš„å¤šçº¿ç¨‹é—®é¢˜ï¼Œå¦‚æ­»é”ã€ç«æ€æ¡ä»¶ç­‰ã€‚å¯¹äºåˆå­¦è€…æ¥è¯´ï¼ŒæŒæ¡å¹¶å‘åŒ…çš„ä½¿ç”¨æ˜¯è¿ˆå‘é«˜çº§Javaå¼€å‘çš„é‡è¦ä¸€æ­¥ã€‚

æœ¬æ–‡å°†é€æ­¥ä»‹ç»Javaå¹¶å‘åŒ…çš„æ ¸å¿ƒç»„ä»¶ï¼Œå¹¶é€šè¿‡ä»£ç ç¤ºä¾‹å’Œå®é™…æ¡ˆä¾‹å¸®åŠ©ä½ ç†è§£å…¶ç”¨æ³•ã€‚

---

## æ ¸å¿ƒç»„ä»¶

Javaå¹¶å‘åŒ…åŒ…å«ä»¥ä¸‹å‡ ä¸ªä¸»è¦ç»„ä»¶ï¼š

1. **çº¿ç¨‹æ± ï¼ˆThreadPoolExecutorï¼‰**
2. **å¹¶å‘é›†åˆï¼ˆConcurrent Collectionsï¼‰**
3. **åŒæ­¥å·¥å…·ï¼ˆSynchronizersï¼‰**
4. **åŸå­å˜é‡ï¼ˆAtomic Variablesï¼‰**
5. **é”ï¼ˆLocksï¼‰**

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†é€ä¸€è®²è§£è¿™äº›ç»„ä»¶ã€‚

---

### 1. çº¿ç¨‹æ± ï¼ˆThreadPoolExecutorï¼‰

çº¿ç¨‹æ± æ˜¯ç®¡ç†å¤šä¸ªçº¿ç¨‹çš„å·¥å…·ï¼Œå®ƒå¯ä»¥å‡å°‘çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯çš„å¼€é”€ï¼Œæé«˜ç³»ç»Ÿæ€§èƒ½ã€‚Javaæä¾›äº†`ExecutorService`æ¥å£åŠå…¶å®ç°ç±»`ThreadPoolExecutor`æ¥ç®¡ç†çº¿ç¨‹æ± ã€‚

#### ç¤ºä¾‹ï¼šåˆ›å»ºçº¿ç¨‹æ± å¹¶æ‰§è¡Œä»»åŠ¡

```java
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;

public class ThreadPoolExample {
    public static void main(String[] args) {
        // åˆ›å»ºä¸€ä¸ªå›ºå®šå¤§å°çš„çº¿ç¨‹æ± 
        ExecutorService executor = Executors.newFixedThreadPool(3);

        // æäº¤ä»»åŠ¡
        for (int i = 0; i < 5; i++) {
            executor.submit(() -> {
                System.out.println("Task executed by " + Thread.currentThread().getName());
            });
        }

        // å…³é—­çº¿ç¨‹æ± 
        executor.shutdown();
    }
}
```

#### è¾“å‡º
```
Task executed by pool-1-thread-1
Task executed by pool-1-thread-2
Task executed by pool-1-thread-3
Task executed by pool-1-thread-1
Task executed by pool-1-thread-2
```

:::tip
ä½¿ç”¨çº¿ç¨‹æ± æ—¶ï¼ŒåŠ¡å¿…åœ¨ä»»åŠ¡å®Œæˆåè°ƒç”¨`shutdown()`æ–¹æ³•ï¼Œå¦åˆ™çº¿ç¨‹æ± ä¼šä¸€ç›´è¿è¡Œã€‚
:::

---

### 2. å¹¶å‘é›†åˆï¼ˆConcurrent Collectionsï¼‰

å¹¶å‘é›†åˆæ˜¯çº¿ç¨‹å®‰å…¨çš„é›†åˆç±»ï¼Œé€‚ç”¨äºå¤šçº¿ç¨‹ç¯å¢ƒã€‚å¸¸è§çš„å¹¶å‘é›†åˆåŒ…æ‹¬`ConcurrentHashMap`ã€`CopyOnWriteArrayList`ç­‰ã€‚

#### ç¤ºä¾‹ï¼šä½¿ç”¨`ConcurrentHashMap`

```java
import java.util.concurrent.ConcurrentHashMap;

public class ConcurrentHashMapExample {
    public static void main(String[] args) {
        ConcurrentHashMap<String, Integer> map = new ConcurrentHashMap<>();

        // æ·»åŠ å…ƒç´ 
        map.put("A", 1);
        map.put("B", 2);

        // è·å–å…ƒç´ 
        System.out.println("Value of A: " + map.get("A"));
    }
}
```

#### è¾“å‡º
```
Value of A: 1
```

:::note
`ConcurrentHashMap`é€šè¿‡åˆ†æ®µé”æœºåˆ¶å®ç°çº¿ç¨‹å®‰å…¨ï¼Œé€‚åˆé«˜å¹¶å‘åœºæ™¯ã€‚
:::

---

### 3. åŒæ­¥å·¥å…·ï¼ˆSynchronizersï¼‰

åŒæ­¥å·¥å…·ç”¨äºåè°ƒå¤šä¸ªçº¿ç¨‹çš„æ‰§è¡Œé¡ºåºã€‚å¸¸è§çš„åŒæ­¥å·¥å…·åŒ…æ‹¬`CountDownLatch`ã€`CyclicBarrier`å’Œ`Semaphore`ã€‚

#### ç¤ºä¾‹ï¼šä½¿ç”¨`CountDownLatch`

```java
import java.util.concurrent.CountDownLatch;

public class CountDownLatchExample {
    public static void main(String[] args) throws InterruptedException {
        CountDownLatch latch = new CountDownLatch(3);

        for (int i = 0; i < 3; i++) {
            new Thread(() -> {
                System.out.println("Thread " + Thread.currentThread().getName() + " is running");
                latch.countDown();
            }).start();
        }

        // ç­‰å¾…æ‰€æœ‰çº¿ç¨‹å®Œæˆ
        latch.await();
        System.out.println("All threads have finished");
    }
}
```

#### è¾“å‡º
```
Thread Thread-0 is running
Thread Thread-1 is running
Thread Thread-2 is running
All threads have finished
```

:::caution
`CountDownLatch`æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œè®¡æ•°å½’é›¶åæ— æ³•é‡ç½®ã€‚
:::

---

### 4. åŸå­å˜é‡ï¼ˆAtomic Variablesï¼‰

åŸå­å˜é‡æä¾›äº†ä¸€ç§æ— é”çš„çº¿ç¨‹å®‰å…¨æ“ä½œæ–¹å¼ã€‚å¸¸è§çš„åŸå­å˜é‡åŒ…æ‹¬`AtomicInteger`ã€`AtomicLong`ç­‰ã€‚

#### ç¤ºä¾‹ï¼šä½¿ç”¨`AtomicInteger`

```java
import java.util.concurrent.atomic.AtomicInteger;

public class AtomicIntegerExample {
    public static void main(String[] args) {
        AtomicInteger counter = new AtomicInteger(0);

        // å¢åŠ è®¡æ•°
        counter.incrementAndGet();
        System.out.println("Counter: " + counter.get());
    }
}
```

#### è¾“å‡º
```
Counter: 1
```

:::tip
åŸå­å˜é‡é€‚åˆåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹æ›¿ä»£`synchronized`å…³é”®å­—ã€‚
:::

---

### 5. é”ï¼ˆLocksï¼‰

Javaå¹¶å‘åŒ…æä¾›äº†æ¯”`synchronized`æ›´çµæ´»çš„é”æœºåˆ¶ï¼Œå¦‚`ReentrantLock`ã€‚

#### ç¤ºä¾‹ï¼šä½¿ç”¨`ReentrantLock`

```java
import java.util.concurrent.locks.ReentrantLock;

public class ReentrantLockExample {
    private static final ReentrantLock lock = new ReentrantLock();

    public static void main(String[] args) {
        lock.lock();
        try {
            System.out.println("Locked by " + Thread.currentThread().getName());
        } finally {
            lock.unlock();
        }
    }
}
```

#### è¾“å‡º
```
Locked by main
```

:::warning
ä½¿ç”¨`ReentrantLock`æ—¶ï¼ŒåŠ¡å¿…åœ¨`finally`å—ä¸­é‡Šæ”¾é”ï¼Œä»¥é¿å…æ­»é”ã€‚
:::

---

## å®é™…æ¡ˆä¾‹ï¼šå¤šçº¿ç¨‹ä¸‹è½½å™¨

ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨çº¿ç¨‹æ± å’Œ`CountDownLatch`å®ç°çš„å¤šçº¿ç¨‹ä¸‹è½½å™¨ç¤ºä¾‹ï¼š

```java
import java.util.concurrent.CountDownLatch;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;

public class MultiThreadDownloader {
    public static void main(String[] args) throws InterruptedException {
        int totalFiles = 5;
        CountDownLatch latch = new CountDownLatch(totalFiles);
        ExecutorService executor = Executors.newFixedThreadPool(3);

        for (int i = 0; i < totalFiles; i++) {
            executor.submit(() -> {
                System.out.println("Downloading file: " + Thread.currentThread().getName());
                latch.countDown();
            });
        }

        latch.await();
        System.out.println("All files downloaded");
        executor.shutdown();
    }
}
```

#### è¾“å‡º
```
Downloading file: pool-1-thread-1
Downloading file: pool-1-thread-2
Downloading file: pool-1-thread-3
Downloading file: pool-1-thread-1
Downloading file: pool-1-thread-2
All files downloaded
```

---

## æ€»ç»“

Javaå¹¶å‘åŒ…ä¸ºå¤šçº¿ç¨‹ç¼–ç¨‹æä¾›äº†å¼ºå¤§çš„å·¥å…·ï¼ŒåŒ…æ‹¬çº¿ç¨‹æ± ã€å¹¶å‘é›†åˆã€åŒæ­¥å·¥å…·ã€åŸå­å˜é‡å’Œé”ã€‚é€šè¿‡åˆç†ä½¿ç”¨è¿™äº›å·¥å…·ï¼Œå¯ä»¥æ˜¾è‘—æé«˜ç¨‹åºçš„æ€§èƒ½å’Œå¯é æ€§ã€‚

---

## é™„åŠ èµ„æº

- [Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜](https://book.douban.com/subject/10484692/)
- [Javaå®˜æ–¹æ–‡æ¡£ - java.util.concurrent](https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/package-summary.html)

---

## ç»ƒä¹ 

1. ä¿®æ”¹çº¿ç¨‹æ± ç¤ºä¾‹ï¼Œä½¿ç”¨`CachedThreadPool`ä»£æ›¿`FixedThreadPool`ï¼Œå¹¶è§‚å¯Ÿçº¿ç¨‹æ•°é‡çš„å˜åŒ–ã€‚
2. ä½¿ç”¨`CyclicBarrier`å®ç°ä¸€ä¸ªå¤šçº¿ç¨‹ä»»åŠ¡åè°ƒçš„åœºæ™¯ã€‚
3. å°è¯•ç”¨`AtomicInteger`å®ç°ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„è®¡æ•°å™¨ã€‚

Happy coding! ğŸš€
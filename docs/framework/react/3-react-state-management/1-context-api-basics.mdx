---
title: Context API åŸºç¡€
description: äº†è§£ React ä¸­çš„ Context APIï¼ŒæŒæ¡å¦‚ä½•ä½¿ç”¨å®ƒæ¥ç®¡ç†å…¨å±€çŠ¶æ€ï¼Œé¿å… prop drilling é—®é¢˜ã€‚
---

## ä»‹ç»

åœ¨ React åº”ç”¨ä¸­ï¼Œç»„ä»¶ä¹‹é—´çš„æ•°æ®ä¼ é€’é€šå¸¸é€šè¿‡ props å®ç°ã€‚ç„¶è€Œï¼Œå½“åº”ç”¨å˜å¾—å¤æ‚æ—¶ï¼Œprops çš„å±‚å±‚ä¼ é€’ï¼ˆå³ prop drillingï¼‰ä¼šå¯¼è‡´ä»£ç éš¾ä»¥ç»´æŠ¤ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒReact æä¾›äº† **Context API**ï¼Œå®ƒå…è®¸æˆ‘ä»¬åœ¨ç»„ä»¶æ ‘ä¸­å…±äº«æ•°æ®ï¼Œè€Œä¸å¿…æ˜¾å¼åœ°é€šè¿‡æ¯ä¸€å±‚ä¼ é€’ propsã€‚

Context API æ˜¯ä¸€ç§ç”¨äºåœ¨ç»„ä»¶æ ‘ä¸­å…±äº«å…¨å±€æ•°æ®çš„æœºåˆ¶ã€‚å®ƒç‰¹åˆ«é€‚ç”¨äºä¸»é¢˜ã€ç”¨æˆ·è®¤è¯çŠ¶æ€ã€è¯­è¨€åå¥½ç­‰éœ€è¦åœ¨å¤šä¸ªç»„ä»¶ä¸­å…±äº«çš„æ•°æ®ã€‚

---

## Context API çš„æ ¸å¿ƒæ¦‚å¿µ

Context API çš„æ ¸å¿ƒåŒ…æ‹¬ä»¥ä¸‹ä¸‰ä¸ªéƒ¨åˆ†ï¼š

1. **React.createContext**ï¼šåˆ›å»ºä¸€ä¸ª Context å¯¹è±¡ã€‚
2. **Context.Provider**ï¼šç”¨äºæä¾›æ•°æ®ï¼ŒåŒ…è£¹éœ€è¦è®¿é—®è¯¥æ•°æ®çš„ç»„ä»¶ã€‚
3. **Context.Consumer** æˆ– **useContext Hook**ï¼šç”¨äºåœ¨ç»„ä»¶ä¸­æ¶ˆè´¹ Context æ•°æ®ã€‚

---

## åˆ›å»º Context

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ `React.createContext` åˆ›å»ºä¸€ä¸ª Context å¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡åŒ…å«ä¸¤ä¸ªç»„ä»¶ï¼š`Provider` å’Œ `Consumer`ã€‚

```jsx
import React from 'react';

// åˆ›å»ºä¸€ä¸ª Context å¯¹è±¡
const ThemeContext = React.createContext('light'); // 'light' æ˜¯é»˜è®¤å€¼
```

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º `ThemeContext` çš„ Context å¯¹è±¡ï¼Œå¹¶ä¸ºå…¶è®¾ç½®äº†é»˜è®¤å€¼ `'light'`ã€‚

---

## ä½¿ç”¨ Provider æä¾›æ•°æ®

`Provider` ç»„ä»¶ç”¨äºå°†æ•°æ®ä¼ é€’ç»™å…¶å­ç»„ä»¶ã€‚å®ƒæ¥å—ä¸€ä¸ª `value` å±æ€§ï¼Œè¯¥å±æ€§çš„å€¼å¯ä»¥æ˜¯ä»»ä½•ç±»å‹çš„æ•°æ®ï¼ˆå¦‚å­—ç¬¦ä¸²ã€å¯¹è±¡ã€å‡½æ•°ç­‰ï¼‰ã€‚

```jsx
function App() {
  return (
    <ThemeContext.Provider value="dark">
      <Toolbar />
    </ThemeContext.Provider>
  );
}

function Toolbar() {
  return (
    <div>
      <ThemedButton />
    </div>
  );
}
```

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ`ThemeContext.Provider` å°† `value` è®¾ç½®ä¸º `'dark'`ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™ `Toolbar` ç»„ä»¶åŠå…¶å­ç»„ä»¶ã€‚

---

## ä½¿ç”¨ Consumer æˆ– useContext æ¶ˆè´¹æ•°æ®

æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥æ¶ˆè´¹ Context æ•°æ®ï¼š

1. **ä½¿ç”¨ `Context.Consumer`**ï¼šé€‚ç”¨äºç±»ç»„ä»¶æˆ–éœ€è¦æ›´å¤æ‚é€»è¾‘çš„åœºæ™¯ã€‚
2. **ä½¿ç”¨ `useContext` Hook**ï¼šé€‚ç”¨äºå‡½æ•°ç»„ä»¶ï¼Œæ›´ç®€æ´ã€‚

### ä½¿ç”¨ `Context.Consumer`

```jsx
function ThemedButton() {
  return (
    <ThemeContext.Consumer>
      {theme => <button style={{ backgroundColor: theme === 'dark' ? '#333' : '#FFF' }}>Themed Button</button>}
    </ThemeContext.Consumer>
  );
}
```

### ä½¿ç”¨ `useContext` Hook

```jsx
import React, { useContext } from 'react';

function ThemedButton() {
  const theme = useContext(ThemeContext);
  return (
    <button style={{ backgroundColor: theme === 'dark' ? '#333' : '#FFF' }}>
      Themed Button
    </button>
  );
}
```

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ`ThemedButton` ç»„ä»¶é€šè¿‡ `useContext` è·å– `ThemeContext` çš„å€¼ï¼Œå¹¶æ ¹æ®ä¸»é¢˜è®¾ç½®æŒ‰é’®çš„èƒŒæ™¯é¢œè‰²ã€‚

---

## å®é™…åº”ç”¨åœºæ™¯

### åœºæ™¯ï¼šç”¨æˆ·è®¤è¯çŠ¶æ€ç®¡ç†

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåº”ç”¨ï¼Œéœ€è¦åœ¨å¤šä¸ªç»„ä»¶ä¸­å…±äº«ç”¨æˆ·çš„è®¤è¯çŠ¶æ€ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Context API æ¥å®ç°è¿™ä¸€éœ€æ±‚ã€‚

```jsx
import React, { createContext, useContext, useState } from 'react';

// åˆ›å»º Context
const AuthContext = createContext();

function App() {
  const [isAuthenticated, setIsAuthenticated] = useState(false);

  return (
    <AuthContext.Provider value={{ isAuthenticated, setIsAuthenticated }}>
      <Navbar />
      <MainContent />
    </AuthContext.Provider>
  );
}

function Navbar() {
  const { isAuthenticated, setIsAuthenticated } = useContext(AuthContext);

  return (
    <nav>
      <button onClick={() => setIsAuthenticated(!isAuthenticated)}>
        {isAuthenticated ? 'Logout' : 'Login'}
      </button>
    </nav>
  );
}

function MainContent() {
  const { isAuthenticated } = useContext(AuthContext);

  return (
    <div>
      {isAuthenticated ? <h1>Welcome back!</h1> : <h1>Please log in.</h1>}
    </div>
  );
}
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`AuthContext` ç”¨äºç®¡ç†ç”¨æˆ·çš„è®¤è¯çŠ¶æ€ï¼Œ`Navbar` å’Œ `MainContent` ç»„ä»¶éƒ½å¯ä»¥è®¿é—®å’Œæ›´æ–°è¿™ä¸ªçŠ¶æ€ã€‚

---

## æ€»ç»“

Context API æ˜¯ React ä¸­ç”¨äºç®¡ç†å…¨å±€çŠ¶æ€çš„å¼ºå¤§å·¥å…·ã€‚å®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬é¿å… prop drillingï¼Œä½¿ä»£ç æ›´åŠ ç®€æ´å’Œå¯ç»´æŠ¤ã€‚é€šè¿‡ `createContext`ã€`Provider` å’Œ `useContext`ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°åœ¨ç»„ä»¶æ ‘ä¸­å…±äº«æ•°æ®ã€‚

:::tip
- ä½¿ç”¨ Context API æ—¶ï¼Œå°½é‡é¿å…å°†è¿‡å¤šçš„æ•°æ®æ”¾å…¥ä¸€ä¸ª Context ä¸­ï¼Œä»¥å…å¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚
- å¦‚æœåº”ç”¨éå¸¸å¤æ‚ï¼Œå¯ä»¥è€ƒè™‘ç»“åˆçŠ¶æ€ç®¡ç†åº“ï¼ˆå¦‚ Reduxï¼‰ä½¿ç”¨ã€‚
:::

---

## é™„åŠ èµ„æºä¸ç»ƒä¹ 

### èµ„æº
- [React å®˜æ–¹æ–‡æ¡£ - Context](https://reactjs.org/docs/context.html)
- [useContext Hook æ–‡æ¡£](https://reactjs.org/docs/hooks-reference.html#usecontext)

### ç»ƒä¹ 
1. åˆ›å»ºä¸€ä¸ª `LanguageContext`ï¼Œç”¨äºåœ¨åº”ç”¨ä¸­åˆ‡æ¢è¯­è¨€ï¼ˆå¦‚ä¸­æ–‡å’Œè‹±æ–‡ï¼‰ã€‚
2. å°è¯•å°† Context API ä¸ `useReducer` ç»“åˆä½¿ç”¨ï¼Œå®ç°ä¸€ä¸ªç®€å•çš„è®¡æ•°å™¨åº”ç”¨ã€‚

Happy coding! ğŸš€
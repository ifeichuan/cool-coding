---
title: Android Espresso
description: "äº†è§£å¦‚ä½•ä½¿ç”¨ Android Espresso è¿›è¡Œ UI æµ‹è¯•ï¼ŒæŒæ¡ç¼–å†™å¯é ä¸”é«˜æ•ˆçš„è‡ªåŠ¨åŒ–æµ‹è¯•ç”¨ä¾‹çš„æŠ€å·§ã€‚"
---

# Android Espresso

## ä»‹ç»

Android Espresso æ˜¯ Google æä¾›çš„ä¸€ä¸ªç”¨äºç¼–å†™ Android UI æµ‹è¯•çš„å¼ºå¤§æ¡†æ¶ã€‚å®ƒå…è®¸å¼€å‘è€…ä»¥ç®€æ´çš„æ–¹å¼ç¼–å†™è‡ªåŠ¨åŒ–æµ‹è¯•ç”¨ä¾‹ï¼Œç¡®ä¿åº”ç”¨ç¨‹åºçš„ç”¨æˆ·ç•Œé¢åœ¨å„ç§åœºæ™¯ä¸‹éƒ½èƒ½æ­£å¸¸å·¥ä½œã€‚Espresso çš„è®¾è®¡ç›®æ ‡æ˜¯è®©æµ‹è¯•ä»£ç æ›´æ˜“è¯»ã€æ›´æ˜“ç»´æŠ¤ï¼ŒåŒæ—¶æä¾›é«˜æ•ˆçš„æµ‹è¯•æ‰§è¡Œã€‚

Espresso çš„æ ¸å¿ƒæ€æƒ³æ˜¯æ¨¡æ‹Ÿç”¨æˆ·ä¸åº”ç”¨ç¨‹åºçš„äº¤äº’ï¼Œä¾‹å¦‚ç‚¹å‡»æŒ‰é’®ã€è¾“å…¥æ–‡æœ¬ã€æ»‘åŠ¨å±å¹•ç­‰ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¼€å‘è€…å¯ä»¥éªŒè¯åº”ç”¨ç¨‹åºçš„ UI è¡Œä¸ºæ˜¯å¦ç¬¦åˆé¢„æœŸã€‚

## ä¸ºä»€ä¹ˆä½¿ç”¨ Espressoï¼Ÿ

- **ç®€æ´æ˜“ç”¨**ï¼šEspresso çš„ API è®¾è®¡éå¸¸ç›´è§‚ï¼Œé€‚åˆåˆå­¦è€…å¿«é€Ÿä¸Šæ‰‹ã€‚
- **é«˜æ•ˆæ‰§è¡Œ**ï¼šEspresso ä¼šè‡ªåŠ¨åŒæ­¥æµ‹è¯•æ“ä½œä¸ UI çº¿ç¨‹ï¼Œç¡®ä¿æµ‹è¯•çš„ç¨³å®šæ€§ã€‚
- **å¯æ‰©å±•æ€§**ï¼šEspresso æ”¯æŒè‡ªå®šä¹‰åŒ¹é…å™¨å’Œæ“ä½œï¼Œæ»¡è¶³å¤æ‚æµ‹è¯•éœ€æ±‚ã€‚

## å®‰è£…ä¸é…ç½®

åœ¨å¼€å§‹ä½¿ç”¨ Espresso ä¹‹å‰ï¼Œéœ€è¦åœ¨é¡¹ç›®ä¸­æ·»åŠ ç›¸å…³ä¾èµ–ã€‚æ‰“å¼€ `build.gradle` æ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹ä¾èµ–é¡¹ï¼š

```groovy
dependencies {
    androidTestImplementation 'androidx.test.espresso:espresso-core:3.5.1'
    androidTestImplementation 'androidx.test:runner:1.5.2'
    androidTestImplementation 'androidx.test:rules:1.5.2'
}
```

ç¡®ä¿åœ¨ `defaultConfig` ä¸­æŒ‡å®šæµ‹è¯•è¿è¡Œå™¨ï¼š

```groovy
android {
    defaultConfig {
        testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"
    }
}
```

## ç¼–å†™ç¬¬ä¸€ä¸ª Espresso æµ‹è¯•

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ Espresso æµ‹è¯•ç¤ºä¾‹ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåŒ…å«æŒ‰é’®å’Œæ–‡æœ¬è§†å›¾çš„ç•Œé¢ï¼Œç‚¹å‡»æŒ‰é’®åæ–‡æœ¬è§†å›¾ä¼šæ˜¾ç¤º "Hello, Espresso!"ã€‚

```kotlin
import androidx.test.espresso.Espresso
import androidx.test.espresso.action.ViewActions
import androidx.test.espresso.assertion.ViewAssertions
import androidx.test.espresso.matcher.ViewMatchers
import androidx.test.ext.junit.rules.ActivityScenarioRule
import androidx.test.ext.junit.runners.AndroidJUnit4
import org.junit.Rule
import org.junit.Test
import org.junit.runner.RunWith

@RunWith(AndroidJUnit4::class)
class MainActivityTest {

    @get:Rule
    val activityRule = ActivityScenarioRule(MainActivity::class.java)

    @Test
    fun testButtonClick() {
        // æŸ¥æ‰¾æŒ‰é’®å¹¶æ‰§è¡Œç‚¹å‡»æ“ä½œ
        Espresso.onView(ViewMatchers.withId(R.id.button))
            .perform(ViewActions.click())

        // éªŒè¯æ–‡æœ¬è§†å›¾æ˜¯å¦æ˜¾ç¤ºé¢„æœŸçš„æ–‡æœ¬
        Espresso.onView(ViewMatchers.withId(R.id.textView))
            .check(ViewAssertions.matches(ViewMatchers.withText("Hello, Espresso!")))
    }
}
```

### ä»£ç è§£æ

1. **`ActivityScenarioRule`**ï¼šç”¨äºå¯åŠ¨ `MainActivity`ï¼Œç¡®ä¿æµ‹è¯•åœ¨æ­£ç¡®çš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œã€‚
2. **`Espresso.onView`**ï¼šæŸ¥æ‰¾æŒ‡å®šçš„è§†å›¾ã€‚
3. **`ViewActions.click()`**ï¼šæ¨¡æ‹Ÿç‚¹å‡»æ“ä½œã€‚
4. **`ViewAssertions.matches`**ï¼šéªŒè¯è§†å›¾çš„çŠ¶æ€æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚

## å¸¸ç”¨ API

### æŸ¥æ‰¾è§†å›¾

- **`withId`**ï¼šé€šè¿‡èµ„æº ID æŸ¥æ‰¾è§†å›¾ã€‚
- **`withText`**ï¼šé€šè¿‡æ–‡æœ¬å†…å®¹æŸ¥æ‰¾è§†å›¾ã€‚
- **`withHint`**ï¼šé€šè¿‡æç¤ºæ–‡æœ¬æŸ¥æ‰¾è§†å›¾ã€‚

### æ‰§è¡Œæ“ä½œ

- **`click()`**ï¼šç‚¹å‡»è§†å›¾ã€‚
- **`typeText()`**ï¼šåœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥æ–‡æœ¬ã€‚
- **`scrollTo()`**ï¼šæ»šåŠ¨åˆ°æŒ‡å®šè§†å›¾ã€‚

### éªŒè¯çŠ¶æ€

- **`matches`**ï¼šéªŒè¯è§†å›¾çš„çŠ¶æ€æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚
- **`isDisplayed`**ï¼šéªŒè¯è§†å›¾æ˜¯å¦æ˜¾ç¤ºã€‚
- **`isEnabled`**ï¼šéªŒè¯è§†å›¾æ˜¯å¦å¯ç”¨ã€‚

## å®é™…æ¡ˆä¾‹

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç™»å½•é¡µé¢ï¼ŒåŒ…å«ç”¨æˆ·åè¾“å…¥æ¡†ã€å¯†ç è¾“å…¥æ¡†å’Œç™»å½•æŒ‰é’®ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼ŒéªŒè¯ç”¨æˆ·è¾“å…¥æ­£ç¡®çš„å‡­æ®åæ˜¯å¦å¯ä»¥æˆåŠŸç™»å½•ï¼š

```kotlin
@Test
fun testLoginSuccess() {
    // è¾“å…¥ç”¨æˆ·å
    Espresso.onView(ViewMatchers.withId(R.id.username))
        .perform(ViewActions.typeText("user@example.com"))

    // è¾“å…¥å¯†ç 
    Espresso.onView(ViewMatchers.withId(R.id.password))
        .perform(ViewActions.typeText("password123"))

    // ç‚¹å‡»ç™»å½•æŒ‰é’®
    Espresso.onView(ViewMatchers.withId(R.id.loginButton))
        .perform(ViewActions.click())

    // éªŒè¯æ˜¯å¦è·³è½¬åˆ°ä¸»é¡µ
    Espresso.onView(ViewMatchers.withId(R.id.homeScreen))
        .check(ViewAssertions.matches(ViewMatchers.isDisplayed()))
}
```

:::tip
åœ¨å®é™…æµ‹è¯•ä¸­ï¼Œå»ºè®®ä½¿ç”¨ `ViewActions.closeSoftKeyboard()` å…³é—­è½¯é”®ç›˜ï¼Œä»¥é¿å…å¹²æ‰°æµ‹è¯•ã€‚
:::

## æ€»ç»“

Android Espresso æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ä¸”æ˜“äºä½¿ç”¨çš„ UI æµ‹è¯•æ¡†æ¶ï¼Œé€‚åˆåˆå­¦è€…å¿«é€Ÿä¸Šæ‰‹ã€‚é€šè¿‡æ¨¡æ‹Ÿç”¨æˆ·æ“ä½œå¹¶éªŒè¯ UI çŠ¶æ€ï¼Œå¼€å‘è€…å¯ä»¥ç¡®ä¿åº”ç”¨ç¨‹åºåœ¨å„ç§åœºæ™¯ä¸‹éƒ½èƒ½æ­£å¸¸å·¥ä½œã€‚

## é™„åŠ èµ„æº

- [Espresso å®˜æ–¹æ–‡æ¡£](https://developer.android.com/training/testing/espresso)
- [Android Testing Codelab](https://developer.android.com/codelabs/android-testing)

## ç»ƒä¹ 

1. ä¸ºä½ çš„åº”ç”¨ç¨‹åºç¼–å†™ä¸€ä¸ª Espresso æµ‹è¯•ï¼ŒéªŒè¯ç‚¹å‡»æŒ‰é’®åæ–‡æœ¬è§†å›¾çš„å†…å®¹æ˜¯å¦æ­£ç¡®æ›´æ–°ã€‚
2. å°è¯•ä½¿ç”¨ `ViewActions.scrollTo()` æµ‹è¯•ä¸€ä¸ªéœ€è¦æ»šåŠ¨çš„ç•Œé¢ã€‚
3. ç¼–å†™ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼ŒéªŒè¯è¾“å…¥é”™è¯¯å‡­æ®æ—¶æ˜¯å¦ä¼šæ˜¾ç¤ºé”™è¯¯æç¤ºã€‚

Happy Testing! ğŸš€